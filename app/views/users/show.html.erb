<main class="mt-3">
  <div class="container">

    <div class="row">
      <p class="text-left col">
        <% if @user.admin && @user.committee %>
          <span class="toca-uppercase color-toca-red">Admin & Committee Member</span><br>
        <% elsif @user.admin %>
          <span class="toca-uppercase color-toca-red">Admin</span><br>
        <% elsif @user.committee %>
          <span class="toca-uppercase color-toca-red">Committee Member</span><br>
        <% end %>
      </p>
      <p class="text-right col">
        <%= link_to('Edit My Information', edit_user_registration_path(current_user)) %>
        &nbsp;&nbsp;|&nbsp;&nbsp;
        <%= link_to('Log Out', destroy_user_session_path, method: :delete) %>
      </p>
    </div> <!-- row -->

    <h1 class="text-center">My Account</h1>

    <section>
      <p class="text-center">
        <%= @user.first_name %> <%= @user.last_name %> (<%= @user.location %>)<br>
        <%= number_to_phone(@user.phone) %>&nbsp;&nbsp;|&nbsp;&nbsp;<%= mail_to @user.email %>
      </p>
    </section> <!-- user info -->

    <% if @user.committee %>
      <h2 class="text-center toca-uppercase color-toca-red mt-5">Committee Member Actions</h2>
      <%= link_to home_pending_path, class: "btn btn-secondary my-3 btn-lg btn-block" do %>
        All Applications Needing Votes
      <% end %>
    <% end %>
    <% if @user.admin %>
      <h2 class="text-center toca-uppercase color-toca-red mt-5">Admin Actions</h2>
      <div class="row">
        <div class="col-md-4 py-2">
          <%= link_to scholarships_path, class: "btn btn-primary btn-lg btn-block" do %>
            All Scholarship<br> Applications
          <% end %>
        </div> <!-- col -->
        <div class="col-md-4 py-2">
          <%= link_to hardships_path, class: "btn btn-primary btn-lg btn-block" do %>
            All Hardship<br> Applications
          <% end %>
        </div> <!-- col -->
        <div class="col-md-4 py-2">
          <%= link_to charities_path, class: "btn btn-primary btn-lg btn-block" do %>
            All Charity<br> Applications
          <% end %>
        </div> <!-- col -->
      </div> <!-- row -->

      <%= link_to users_path, class: "btn btn-secondary my-3 btn-lg btn-block" do %>
        Manage Users
      <% end %>
    <% end %>


    <% if @scholarships.count >= 1 %>
      <section class="my-5"> <!-- scholarship applications -->
        <h2 class="text-center toca-uppercase color-toca-red mt-5">My Scholarship Applications</h2>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead class="black white-text">
              <tr>
                <th scope="col">Application</th>
                <th scope="col">Status</th>
                <th scope="col">Final Decision</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @scholarships.each do |scholarship| %>
                <tr>
                  <td>Scholarship <%= fixed_digit_number(scholarship.id) %> (<%= scholarship.user.last_name %>)</td>
                  <td>
                    <%= scholarship.status %>
                  </td>
                  <td>
                    <% if scholarship.final_decision %>
                      <%= scholarship.final_decision %>
                    <% else %>
                      Not Yet Decided
                    <% end %>
                  </td>
                  <td>
                    <%= link_to "View", scholarship_path(scholarship) %>
                    <% if scholarship.status != "Submitted to Committee" && scholarship.status != "Decision Reached" %>
                      &nbsp;|&nbsp;
                      <%= link_to "Edit", edit_scholarship_path(scholarship) %>
                    <% end %>
                    &nbsp;|&nbsp;
                    <%= button_to "Withdraw", withdraw_scholarship_path(scholarship), method: :post, data: { confirm: "Are you sure you want to withdraw your application?"}, class: "not-button" %>
                  </td>
                </tr>
              <% end %> <!-- hardships each -->
            </tbody>
          </table>
        </div> <!-- responsive table -->
      </section> <!-- scholarships -->
    <% end %> <!-- if scholarships.count >= 1 -->



    <% if @hardships.count >= 1 %>
      <section class="my-5"> <!-- hardship applications -->
        <h2 class="text-center toca-uppercase color-toca-red mt-4">My Hardship Applications</h2>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead class="black white-text">
              <tr>
                <th scope="col">Application</th>
                <th scope="col">Status</th>
                <th scope="col">Final Decision</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @hardships.each do |hardship| %>
                <tr>
                  <td>Hardship <%= fixed_digit_number(hardship.id) %> (<%= hardship.user.last_name %>)</td>
                  <td>
                    <%= hardship.status %>
                  </td>
                  <td>
                    <% if hardship.final_decision %>
                      <%= hardship.final_decision %>
                    <% else %>
                      Not Yet Decided
                    <% end %>
                  </td>
                  <td>
                    <%= link_to "View", hardship_path(hardship) %>
                    <% if hardship.status != "Submitted to Committee" && hardship.status != "Decision Reached" %>
                      &nbsp;|&nbsp;
                      <%= link_to "Edit", edit_hardship_path(hardship) %>
                    <% end %>
                    &nbsp;|&nbsp;
                    <%= button_to "Withdraw", withdraw_hardship_path(hardship), method: :post, data: { confirm: "Are you sure you want to withdraw your application?"}, class: "not-button" %>
                  </td>
                </tr>
              <% end %> <!-- hardships each -->
            </tbody>
          </table>
        </div> <!-- responsive table -->
      </section> <!-- hardships -->
    <% end %> <!-- if hardships.count >= 1 -->



    <% if @charities.count >= 1 %>
      <section class="mt-5"> <!-- charity applications -->
        <h2 class="text-center toca-uppercase color-toca-red mt-4">My Charity Applications</h2>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead class="black white-text">
              <tr>
                <th scope="col">Application</th>
                <th scope="col">Status</th>
                <th scope="col">Final Decision</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @charities.each do |charity| %>
                <tr>
                  <td>Charity <%= fixed_digit_number(charity.id) %> (<%= charity.user.last_name %>)</td>
                  <td>
                    <%= charity.status %>
                  </td>
                  <td>
                    <% if charity.final_decision %>
                      <%= charity.final_decision %>
                    <% else %>
                      Not Yet Decided
                    <% end %>
                  </td>
                  <td>
                    <%= link_to "View", charity_path(charity) %>
                    <% if charity.status != "Submitted to Committee" && charity.status != "Decision Reached" %>
                      &nbsp;|&nbsp;
                      <%= link_to "Edit", edit_charity_path(charity) %>
                    <% end %>
                    &nbsp;|&nbsp;
                    <%= button_to "Withdraw", withdraw_charity_path(charity), method: :post, data: { confirm: "Are you sure you want to withdraw your application?"}, class: "not-button" %>
                  </td>
                </tr>
              <% end %> <!-- charities each -->
            </tbody>
          </table>
        </div> <!-- responsive table -->
      </section> <!-- charities -->
    <% end %> <!-- if charities.count >= 1 -->

    <% if @user.committee == false %>
      <div class="text-center mb-5">
        <% if @user.committee_request == "Requested" %>
          <p><em>You have already requested to be a member of the deciding committee.</em></p>
        <% else %>
            <p><em>Want to help decide which applications get approved for a TOCA Cares grant?
              <br>Click <%= link_to "here", committee_request_path(@user), method: :post %> to request to serve as a member of the deciding committee.</em></p>
        <% end %>
      </div> <!-- committee request -->
    <% end %>

  </div> <!-- container -->
</main>
